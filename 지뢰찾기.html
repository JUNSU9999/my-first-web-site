<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>지뢰찾기 게임</title>
  <style>
    table {
      border-collapse: collapse;
    }
    td {
      width: 30px;
      height: 30px;
      border: 1px solid black;
      text-align: center;
      vertical-align: middle;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
    }
    .mine {
      background-color: red;
      color: white;
    }
    .revealed {
      background-color: lightgray;
    }
  </style>
</head>
<body>
  <table id="game-board"></table>

  <script>
    const ROWS = 10;
    const COLS = 10;
    const NUM_MINES = 10;

    let gameBoard = [];
    let revealedBoard = [];

    // 게임판 초기화
    function initGameBoard() {
      // 빈 게임판 생성
      for (let i = 0; i < ROWS; i++) {
        gameBoard[i] = [];
        revealedBoard[i] = [];
        for (let j = 0; j < COLS; j++) {
          gameBoard[i][j] = 0;
          revealedBoard[i][j] = false;
        }
      }

      // 랜덤으로 지뢰 심기
      let numMinesPlanted = 0;
      while (numMinesPlanted < NUM_MINES) {
        let row = Math.floor(Math.random() * ROWS);
        let col = Math.floor(Math.random() * COLS);
        if (gameBoard[row][col] !== -1) {
          gameBoard[row][col] = -1;
          numMinesPlanted++;
        }
      }

      // 각 칸의 숫자 계산
      for (let i = 0; i < ROWS; i++) {
        for (let j = 0; j < COLS; j++) {
          if (gameBoard[i][j] !== -1) {
            let numMines = 0;
            for (let k = i - 1; k <= i + 1; k++) {
              for (let l = j - 1; l <= j + 1; l++) {
                if (k >= 0 && k < ROWS && l >= 0 && l < COLS && gameBoard[k][l] === -1) {
                  numMines++;
                }
              }
            }
            gameBoard[i][j] = numMines;
          }
        }
      }
    }

    // 게임판 그리기
    function drawGameBoard() {
      let table = document.getElementById('game-board');
      for (let i = 0; i < ROWS; i++) {
        let row = document.createElement('tr');
        for (let j = 0; j < COLS; j++) {
          let cell = document.createElement('td');
          cell.dataset.row = i;
          cell.dataset.col = j;
          cell.addEventListener('click', handleCellClick);
          row.appendChild(cell);
        }
        table.appendChild(row);
      }
    }

    // 게임 진행
    function handleCellClick(event) {
      let row = parseInt(event.target.dataset.row);
      let col = parseInt(event.target.dataset.col);
      if (gameBoard[row][col] === -1) {
        alert('지뢰를 밟았습니다! 게임 오버!');
      } else {
        revealCell(row, col);
        checkForWin();
      }
    }

    // 해당 칸과 인접한 칸 모두 오픈
    function revealCell(row, col) {
      if (!revealedBoard[row][col]) {
        revealedBoard[row][col] = true;
        let cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
        cell.classList.add('revealed');
        if (gameBoard[row][col] === 0) {
          for (let i = row - 1; i <= row + 1; i++) {
            for (let j = col - 1; j <= col + 1; j++) {
              if (i >= 0 && i < ROWS && j >= 0 && j < COLS && !revealedBoard[i][j]) {
                revealCell(i, j);
              }
            }
          }
        } else {
          cell.textContent = gameBoard[row][col];
        }
      }
    }

    // 승리 확인
    function checkForWin() {
      let numRevealedCells = 0;
      for (let i = 0; i < ROWS; i++) {
        for (let j = 0; j < COLS; j++) {
          if (revealedBoard[i][j]) {
            numRevealedCells++;
          }
        }
      }
      if (numRevealedCells === ROWS * COLS - NUM_MINES) {
        alert('축하합니다! 게임에서 이겼습니다!');
      }
    }

    // 게임 실행
    initGameBoard();
    drawGameBoard();
  </script>
</body>
</html>